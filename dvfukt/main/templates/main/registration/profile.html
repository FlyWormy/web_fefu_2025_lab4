{% extends 'main/base.html' %}

{% block title %}–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å - FEFU Labs{% endblock %}

{% block content %}
<div style="max-width: 1200px; margin: 0 auto;">
    <div style="background: #e9ecef; padding: 30px; border-radius: 10px; margin-bottom: 30px;">
        <div style="display: flex; align-items: center; gap: 30px;">
            <div>
                {% if profile.avatar %}
                    <img src="{{ profile.avatar.url }}" alt="–ê–≤–∞—Ç–∞—Ä" style="width: 150px; height: 150px; border-radius: 50%; object-fit: cover;">
                {% else %}
                    <div style="width: 150px; height: 150px; border-radius: 50%; background: #6c757d; display: flex; align-items: center; justify-content: center; color: white; font-size: 3em;">
                        {{ user.first_name|first|upper }}
                    </div>
                {% endif %}
            </div>

            <div style="flex: 1;">
                <h1 style="margin-top: 0;">{{ user.get_full_name }}</h1>
                <p>
                    <span style="background: {% if profile.role == 'ADMIN' %}#dc3545{% elif profile.role == 'TEACHER' %}#007bff{% else %}#28a745{% endif %}; color: white; padding: 4px 12px; border-radius: 20px; font-size: 0.9em;">
                        {{ profile.get_role_display }}
                    </span>
                </p>
                <p><strong>Email:</strong> {{ user.email }}</p>
                {% if profile.phone %}<p><strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong> {{ profile.phone }}</p>{% endif %}
                {% if profile.faculty %}<p><strong>–§–∞–∫—É–ª—å—Ç–µ—Ç:</strong> {{ profile.get_faculty_display }}</p>{% endif %}
                {% if profile.date_of_birth %}<p><strong>–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è:</strong> {{ profile.date_of_birth }}</p>{% endif %}

                <div style="margin-top: 20px;">
                    <a href="{% url 'profile_edit' %}" class="btn">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</a>
                </div>
            </div>
        </div>
    </div>

    {% if profile.description %}
    <div style="background: white; padding: 25px; border-radius: 8px; margin-bottom: 30px; border: 1px solid #dee2e6;">
        <h3>üìù –û —Å–µ–±–µ</h3>
        <p style="white-space: pre-line;">{{ profile.description }}</p>
    </div>
    {% endif %}

    {% if profile.role == 'STUDENT' %}
    <div style="background: white; padding: 25px; border-radius: 8px; border: 1px solid #dee2e6;">
        <h2>üéì –ú–æ–∏ –∫—É—Ä—Å—ã</h2>

        {% if enrollments %}
        <div style="margin-top: 20px;">
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="background: #f8f9fa;">
                        <th style="padding: 12px 15px; text-align: left; border-bottom: 2px solid #dee2e6;">–ö—É—Ä—Å</th>
                        <th style="padding: 12px 15px; text-align: left; border-bottom: 2px solid #dee2e6;">–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å</th>
                        <th style="padding: 12px 15px; text-align: left; border-bottom: 2px solid #dee2e6;">–î–∞—Ç–∞ –∑–∞–ø–∏—Å–∏</th>
                        <th style="padding: 12px 15px; text-align: left; border-bottom: 2px solid #dee2e6;">–°—Ç–∞—Ç—É—Å</th>
                        <th style="padding: 12px 15px; text-align: left; border-bottom: 2px solid #dee2e6;">–û—Ü–µ–Ω–∫–∞</th>
                    </tr>
                </thead>
                <tbody>
                    {% for enrollment in enrollments %}
                    <tr style="border-bottom: 1px solid #dee2e6;">
                        <td style="padding: 12px 15px;">
                            <a href="{% url 'course_detail' enrollment.course.id %}" style="color: #007bff; text-decoration: none;">
                                {{ enrollment.course.title }}
                            </a>
                        </td>
                        <td style="padding: 12px 15px;">
                            {{ enrollment.course.instructor.full_name }}
                        </td>
                        <td style="padding: 12px 15px;">
                            {{ enrollment.enrollment_date|date:"d.m.Y" }}
                        </td>
                        <td style="padding: 12px 15px;">
                            <span style="color: {% if enrollment.status == 'active' %}#28a745{% elif enrollment.status == 'completed' %}#007bff{% else %}#dc3545{% endif %};">
                                {{ enrollment.get_status_display }}
                            </span>
                        </td>
                        <td style="padding: 12px 15px;">
                            {% if enrollment.grade %}
                                <strong style="font-size: 1.2em;">{{ enrollment.grade }}</strong>
                            {% else %}
                                <span style="color: #6c757d;">–ù–µ—Ç –æ—Ü–µ–Ω–∫–∏</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p style="color: #6c757d; margin-top: 15px;">–í—ã –µ—â–µ –Ω–µ –∑–∞–ø–∏—Å–∞–ª–∏—Å—å –Ω–∏ –Ω–∞ –æ–¥–∏–Ω –∫—É—Ä—Å.</p>
        <a href="{% url 'course_list' %}" class="btn" style="margin-top: 10px;">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫—É—Ä—Å—ã</a>
        {% endif %}
    </div>
    {% endif %}

    {% if profile.role == 'TEACHER' or profile.role == 'ADMIN' %}
    <div style="background: white; padding: 25px; border-radius: 8px; border: 1px solid #dee2e6; margin-top: 20px;">
        <h2>üë®‚Äçüè´ –ú–æ–∏ –∫—É—Ä—Å—ã –¥–ª—è –ø—Ä–µ–ø–æ–¥–∞–≤–∞–Ω–∏—è</h2>

        {% if taught_courses %}
        <div style="margin-top: 20px;">
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="background: #f8f9fa;">
                        <th style="padding: 12px 15px; text-align: left; border-bottom: 2px solid #dee2e6;">–ö—É—Ä—Å</th>
                        <th style="padding: 12px 15px; text-align: left; border-bottom: 2px solid #dee2e6;">–°—Ç—É–¥–µ–Ω—Ç–æ–≤</th>
                        <th style="padding: 12px 15px; text-align: left; border-bottom: 2px solid #dee2e6;">–°—Ç–∞—Ç—É—Å</th>
                        <th style="padding: 12px 15px; text-align: left; border-bottom: 2px solid #dee2e6;">–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                </thead>
                <tbody>
                    {% for course in taught_courses %}
                    <tr style="border-bottom: 1px solid #dee2e6;">
                        <td style="padding: 12px 15px;">
                            <a href="{% url 'course_detail' course.id %}" style="color: #007bff; text-decoration: none;">
                                {{ course.title }}
                            </a>
                        </td>
                        <td style="padding: 12px 15px; text-align: center;">
                            {{ course.enrollments.count }}
                        </td>
                        <td style="padding: 12px 15px;">
                            <span style="color: {% if course.is_active %}#28a745{% else %}#dc3545{% endif %};">
                                {{ course.is_active|yesno:"–ê–∫—Ç–∏–≤–µ–Ω,–ù–µ –∞–∫—Ç–∏–≤–µ–Ω" }}
                            </span>
                        </td>
                        <td style="padding: 12px 15px;">
                            <a href="{% url 'manage_course_students' course.id %}" class="btn" style="padding: 6px 12px; font-size: 0.9em;">
                                –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—É–¥–µ–Ω—Ç–∞–º–∏
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p style="color: #6c757d; margin-top: 15px;">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∫—É—Ä—Å–æ–≤ –¥–ª—è –ø—Ä–µ–ø–æ–¥–∞–≤–∞–Ω–∏—è.</p>
        {% endif %}
    </div>
    {% endif %}

    <div style="margin-top: 40px; display: flex; gap: 15px;">
        <a href="{% url 'index' %}" class="btn btn-secondary">‚Üê –ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
        {% if profile.role == 'ADMIN' %}
        <a href="{% url 'admin_dashboard' %}" class="btn">‚öôÔ∏è –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</a>
        {% endif %}
    </div>
</div>
{% endblock %}